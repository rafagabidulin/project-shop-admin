"use strict";(self.webpackChunkproject_structure=self.webpackChunkproject_structure||[]).push([[193],{842:(e,t,i)=>{function s(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.d(t,{Z:()=>n});class n{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",{duration:t=2e3,type:i="success"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s(this,"timerId",void 0),this.message=e,this.duration=t,this.type=i,this.render()}getTemplate(){return`\n      <div class="notification ${this.type}" style="--value:${this.duration/1e3}s">\n        <div class="timer"></div>\n        <div class="inner-wrapper">\n          <div class="notification-header">${this.type}</div>\n          <div class="notification-body">\n            ${this.message}\n          </div>\n        </div>\n      </div>\n    `}render(){const e=document.createElement("div");e.innerHTML=this.getTemplate(),this.element=e.firstElementChild}show(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body;n.activeMessage&&n.activeMessage.remove(),e.append(this.element),this.timerId=setTimeout(()=>this.remove(),this.duration),n.activeMessage=this.element}remove(){this.element.remove()}destroy(){clearTimeout(this.timerId),n.activeMessage=null,this.remove()}}s(n,"activeMessage",void 0)},523:(e,t,i)=>{function s(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.d(t,{Z:()=>n});class n{constructor(){let{items:e=[]}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s(this,"element",void 0),s(this,"dragElement",void 0),s(this,"placeholder",void 0),s(this,"left",void 0),s(this,"top",void 0),s(this,"onPointerDown",e=>{const t=e.target.closest(".sortable-list__item");t&&(e.target.closest("[data-grab-handle]")&&(e.preventDefault(),this.onDragStart(e,t)),e.target.closest("[data-delete-handle]")&&(e.preventDefault(),t.remove()))}),s(this,"onPointerMove",e=>{this.moveAt(e.clientX,e.clientY);const t=this.placeholder.previousElementSibling,i=this.placeholder.nextElementSibling,{firstElementChild:s,lastElementChild:n}=this.element,{top:r}=s.getBoundingClientRect(),{bottom:o}=this.element.getBoundingClientRect;if(e.clientY<r)return s.before(this.placeholder);if(e.clientY>o)return n.after(this.placeholder);if(t){const{top:i,height:s}=t.getBoundingClientRect(),n=i+s/2;if(e.clientY<n)return t.before(this.placeholder)}if(i){const{top:t,height:s}=i.getBoundingClientRect(),n=t+s/2;if(e.clientY>n)return i.after(this.placeholder)}}),s(this,"onPointerUp",()=>{const e=[...this.element.children].indexOf(this.placeholder);this.placeholder.replaceWith(this.dragElement),this.dragElement.classList.remove("sortable-list__item_dragging"),this.dragElement.style.cssText="",document.removeEventListener("pointermove",this.onPointerMove),document.removeEventListener("pointerup",this.onPointerUp),e!==this.elementIndex&&this.dispatchEvent("sortable-list-reorder",{from:this.elementIndex,to:e})}),this.items=e,this.render()}getTemplate(){return"\n      <ul class='sortable-list'>\n      </ul>\n    "}getItems(){this.items.map(e=>{e.classList.add("sortable-list__item"),this.element.append(e)})}render(){const e=document.createElement("div");e.innerHTML=this.getTemplate(),this.element=e.firstElementChild,this.getItems(),this.initEventListeners()}onDragStart(e,t){this.left=e.clientX-t.getBoundingClientRect().left,this.top=e.clientY-t.getBoundingClientRect().top,this.dragElement=t,this.elementIndex=[...this.element.children].indexOf(t),this.dragElement.style.width=t.offsetWidth+"px",this.dragElement.style.height=t.offsetHeight+"px",this.dragElement.classList.add("sortable-list__item_dragging"),this.moveAt(e.clientX,e.clientY),this.getPlaceholder(t),document.addEventListener("pointermove",this.onPointerMove),document.addEventListener("pointerup",this.onPointerUp)}getPlaceholder(e){this.placeholder=document.createElement("div"),this.placeholder.className="sortable-list__placeholder",this.placeholder.style.width=e.style.width,this.placeholder.style.height=e.style.height,e.after(this.placeholder)}moveAt(e,t){this.dragElement.style.left=e-this.left+"px",this.dragElement.style.top=t-this.top+"px"}dispatchEvent(e,t){this.element.dispatchEvent(new CustomEvent(e,{bubbles:!0,details:t}))}initEventListeners(){this.element.addEventListener("pointerdown",this.onPointerDown)}remove(){this.element&&this.element.remove()}destroy(){this.remove(),this.element=null,this.dragElement=null,this.placeholder=null}}},434:(e,t,i)=>{i.r(t),i.d(t,{default:()=>a});var s=i(523),n=i(842),r=i(856);function o(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class a{constructor(){o(this,"element",void 0),o(this,"subElements",{}),o(this,"data",[]),o(this,"url",new URL("api/rest/categories?_sort=weight&_refs=subcategory","https://course-js.javascript.ru/")),o(this,"onCategoryToggle",e=>{if(e.target.closest(".category__header")){e.target.closest(".category__header").parentNode.classList.toggle("category_open")}}),o(this,"onOrderChange",e=>{const t=[...e.target.children].map((e,t)=>({id:e.dataset.id,weight:t+1}));this.save(t)})}getTemplate(){return'\n      <div class="categories">\n        <div class="content__top-panel">\n          <h1 class="page-title">Product categories</h1>\n        </div>\n        <p>Subcategories can be dragged and dropped to change their order within their category.</p>\n        <div data-element="categoriesContainer">\n        </div>\n      </div>\n    '}getCategories(){for(const e of this.data){const t=document.createElement("div");t.className="category",t.classList.add("category_open"),t.dataset.id=""+e.id,t.innerHTML=`<header class="category__header">${e.title}</header>`,t.append(this.getCategoriesList(e)),this.subElements.categoriesContainer.append(t)}}getCategoriesList(e){const t=document.createElement("div");t.innerHTML='\n      <div class="category__body">\n        <div class="subcategory-list"></div>\n      <div>\n    ';const i=t.firstElementChild,n=e.subcategories.map(e=>{let{id:t,title:i,count:s}=e;return this.getCategoriesItem(t,i,s)}),r=new s.Z({items:n});this.components={sortableList:r};return i.querySelector(".subcategory-list").append(r.element),i}getCategoriesItem(e,t,i){const s=document.createElement("div");return s.innerHTML=`\n      <li class="categories__sortable-list-item sortable-list__item" data-grab-handle data-id=${e}>\n        <strong>${t}</strong>\n        <span><b>${i}</b> products</span>\n      </li>\n    `,s.firstElementChild}getSubElements(){return[...this.element.querySelectorAll("[data-element]")].reduce((e,t)=>(e[t.dataset.element]=t,e),{})}async render(){this.data=await(0,r.Z)(this.url);const e=document.createElement("div");return e.innerHTML=this.getTemplate(),this.element=e.firstElementChild,this.subElements=this.getSubElements(),this.getCategories(),this.initEventListeners(),this.element}async save(e){try{await(0,r.Z)(new URL("api/rest/subcategories","https://course-js.javascript.ru/"),{method:"PATCH",body:JSON.stringify(e),headers:{"Content-type":"application/json"}}),this.showNotification({type:"success",text:"Order was saved"})}catch(e){this.showNotification({type:"error",text:"Error: "+e})}}showNotification(e){const t=new n.Z(e.text,{duration:2e3,type:e.type});this.components={notification:t},t.show()}initEventListeners(){this.element.addEventListener("pointerdown",this.onCategoryToggle),this.subElements.categoriesContainer.addEventListener("sortable-list-reorder",this.onOrderChange)}remove(){this.element&&this.element.remove()}destroy(){this.remove(),this.element=null,this.subElements={},this.components={},Object.values(this.components).forEach(e=>{e.destroy()})}}},856:(e,t,i)=>{async function s(e,t){let i,s;try{i=await fetch(e.toString(),t)}catch(e){throw new n(i,"Network error has occurred.")}if(!i.ok){let e=i.statusText;try{s=await i.json(),e=s.error&&s.error.message||s.data&&s.data.error&&s.data.error.message||e}catch(e){}let t=`Error ${i.status}: ${e}`;throw new n(i,s,t)}try{return await i.json()}catch(e){throw new n(i,null,e.message)}}i.d(t,{Z:()=>s});class n extends Error{constructor(e,t,i){var s,n,r;super(i),r="FetchError",(n="name")in(s=this)?Object.defineProperty(s,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[n]=r,this.response=e,this.body=t}}window.addEventListener("unhandledrejection",e=>{e.reason instanceof n&&alert(e.reason.message)})}}]);
//# sourceMappingURL=categories-index-js-193.js.map