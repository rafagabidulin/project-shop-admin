{"version":3,"sources":["webpack://project-structure/./src/components/notification/index.js","webpack://project-structure/./src/components/sortable-list/index.js","webpack://project-structure/./src/pages/categories/index.js","webpack://project-structure/./src/utils/fetch-json.js"],"names":["NotificationMessage","constructor","message","duration","type","this","render","getTemplate","wrapper","document","createElement","innerHTML","element","firstElementChild","show","parent","body","activeMessage","remove","append","timerId","setTimeout","destroy","clearTimeout","SortableList","items","event","target","closest","preventDefault","onDragStart","moveAt","clientX","clientY","prevElement","placeholder","previousElementSibling","nextElement","nextElementSibling","lastElementChild","top","firstElementTop","getBoundingClientRect","bottom","before","after","height","middlePrevElement","middleNextElement","placeholderIndex","children","indexOf","replaceWith","dragElement","classList","style","cssText","removeEventListener","onPointerMove","onPointerUp","elementIndex","dispatchEvent","from","to","getItems","map","item","add","initEventListeners","left","width","offsetWidth","offsetHeight","getPlaceholder","addEventListener","className","details","CustomEvent","bubbles","onPointerDown","Page","URL","process","parentNode","toggle","data","value","index","id","dataset","weight","save","getCategories","category","categoryContainer","title","getCategoriesList","subElements","categoriesContainer","categoriesBody","subcategories","count","getCategoriesItem","sortableList","components","querySelector","getSubElements","querySelectorAll","reduce","acc","subElement","fetchJson","url","method","JSON","stringify","headers","showNotification","text","error","notification","onCategoryToggle","onOrderChange","Object","values","forEach","component","async","params","response","fetch","toString","err","FetchError","ok","errorText","statusText","json","status","Error","super","window","reason","alert"],"mappings":"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","file":"categories-index-js-193.js","sourcesContent":["export default class NotificationMessage {\r\n  static activeMessage;\r\n  timerId;\r\n\r\n  constructor(message = '', {duration = 2000, type = 'success'} = {}) {\r\n    this.message = message;\r\n    this.duration = duration;\r\n    this.type = type;\r\n  \r\n    this.render();\r\n  }\r\n    \r\n  getTemplate() {\r\n    return `\r\n      <div class=\"notification ${this.type}\" style=\"--value:${this.duration / 1000}s\">\r\n        <div class=\"timer\"></div>\r\n        <div class=\"inner-wrapper\">\r\n          <div class=\"notification-header\">${this.type}</div>\r\n          <div class=\"notification-body\">\r\n            ${this.message}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n  \r\n  render() {\r\n    const wrapper = document.createElement('div');\r\n\r\n    wrapper.innerHTML = this.getTemplate();\r\n\r\n    this.element = wrapper.firstElementChild;\r\n  }\r\n  \r\n  show(parent = document.body) {\r\n    if (NotificationMessage.activeMessage) {\r\n      NotificationMessage.activeMessage.remove();\r\n    }\r\n    \r\n    parent.append(this.element);\r\n    \r\n    this.timerId = setTimeout(() => this.remove(), this.duration);\r\n\r\n    NotificationMessage.activeMessage = this.element;\r\n  }\r\n  \r\n  remove() {\r\n    this.element.remove();\r\n  }\r\n      \r\n  destroy() {\r\n    clearTimeout(this.timerId);\r\n    NotificationMessage.activeMessage = null;\r\n    this.remove();\r\n  }\r\n}\r\n","export default class SortableList {\r\n  element;\r\n  dragElement;\r\n  placeholder;\r\n  left;\r\n  top;\r\n\r\n  constructor({ items = [] } = {}) {\r\n    this.items = items;\r\n\r\n    this.render();\r\n  }\r\n\r\n  getTemplate() {\r\n    return `\r\n      <ul class='sortable-list'>\r\n      </ul>\r\n    `;\r\n  }\r\n\r\n  getItems() {\r\n    this.items.map((item) => {\r\n      item.classList.add('sortable-list__item');\r\n\r\n      this.element.append(item);\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const element = document.createElement('div');\r\n\r\n    element.innerHTML = this.getTemplate();\r\n\r\n    this.element = element.firstElementChild;\r\n\r\n    this.getItems();\r\n    this.initEventListeners();\r\n  }\r\n\r\n  onPointerDown = (event) => { \r\n    const element = event.target.closest('.sortable-list__item');\r\n\r\n    if (element) {\r\n      if (event.target.closest('[data-grab-handle]')) {\r\n        event.preventDefault();\r\n        this.onDragStart(event, element);\r\n      }\r\n      if (event.target.closest('[data-delete-handle]')) {\r\n        event.preventDefault();\r\n        element.remove();\r\n      }\r\n    }\r\n  }\r\n\r\n  onDragStart(event, element) {\r\n    this.left = event.clientX - element.getBoundingClientRect().left;\r\n    this.top = event.clientY - element.getBoundingClientRect().top;\r\n\r\n    this.dragElement = element;\r\n    this.elementIndex = [...this.element.children].indexOf(element);\r\n    this.dragElement.style.width = element.offsetWidth + 'px';\r\n    this.dragElement.style.height = element.offsetHeight + 'px';\r\n    this.dragElement.classList.add('sortable-list__item_dragging');\r\n\r\n    this.moveAt(event.clientX, event.clientY);\r\n    this.getPlaceholder(element);\r\n\r\n    document.addEventListener('pointermove', this.onPointerMove);\r\n    document.addEventListener('pointerup', this.onPointerUp);\r\n  }\r\n\r\n  getPlaceholder(element) {\r\n    this.placeholder = document.createElement('div');\r\n    this.placeholder.className = 'sortable-list__placeholder';\r\n    this.placeholder.style.width = element.style.width;\r\n    this.placeholder.style.height = element.style.height;\r\n    \r\n    element.after(this.placeholder);   \r\n  }\r\n\r\n  moveAt(clientX, clientY) {\r\n    this.dragElement.style.left = `${clientX - this.left}px`;\r\n    this.dragElement.style.top = `${clientY - this.top}px`;\r\n  }\r\n\r\n  onPointerMove = (event) => {\r\n    this.moveAt(event.clientX, event.clientY);\r\n\r\n    const prevElement = this.placeholder.previousElementSibling;\r\n    const nextElement = this.placeholder.nextElementSibling;\r\n\r\n    const { firstElementChild, lastElementChild } = this.element;\r\n    const { top: firstElementTop } = firstElementChild.getBoundingClientRect();\r\n    const { bottom } = this.element.getBoundingClientRect;\r\n\r\n    if (event.clientY < firstElementTop) {\r\n      return firstElementChild.before(this.placeholder);\r\n    }\r\n\r\n    if (event.clientY > bottom) {\r\n      return lastElementChild.after(this.placeholder);\r\n    }\r\n\r\n    if (prevElement) {\r\n      const { top, height } = prevElement.getBoundingClientRect();\r\n      const middlePrevElement = top + height / 2;\r\n\r\n      if (event.clientY < middlePrevElement) {\r\n        return prevElement.before(this.placeholder);\r\n      }\r\n    }\r\n\r\n    if (nextElement) {\r\n      const { top, height } = nextElement.getBoundingClientRect();\r\n      const middleNextElement = top + height / 2;\r\n\r\n      if (event.clientY > middleNextElement) {\r\n        return nextElement.after(this.placeholder);\r\n      }\r\n    }\r\n  }\r\n\r\n  onPointerUp = () => {\r\n    const placeholderIndex = [...this.element.children].indexOf(this.placeholder);\r\n\r\n    this.placeholder.replaceWith(this.dragElement);\r\n    \r\n    this.dragElement.classList.remove('sortable-list__item_dragging');\r\n    this.dragElement.style.cssText = '';\r\n\r\n    document.removeEventListener('pointermove', this.onPointerMove);\r\n    document.removeEventListener('pointerup', this.onPointerUp);\r\n\r\n    if (placeholderIndex !== this.elementIndex) {\r\n      this.dispatchEvent('sortable-list-reorder', {\r\n        from: this.elementIndex,\r\n        to: placeholderIndex\r\n      });\r\n    }\r\n  }\r\n\r\n  dispatchEvent(type, details) {\r\n    this.element.dispatchEvent(\r\n      new CustomEvent(type, {\r\n        bubbles: true,\r\n        details\r\n      })\r\n    );\r\n  }\r\n\r\n  initEventListeners() {\r\n    this.element.addEventListener('pointerdown', this.onPointerDown);\r\n  }\r\n\r\n  remove() {\r\n    if (this.element) {\r\n      this.element.remove();  \r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n    this.element = null;\r\n    this.dragElement = null;\r\n    this.placeholder = null;\r\n  }\r\n}\r\n","import SortableList from '../../components/sortable-list/index.js';\r\nimport NotificationMessage from '../../components/notification/index.js';\r\nimport fetchJson from '../../utils/fetch-json.js';\r\n\r\nexport default class Page {\r\n  element;\r\n  subElements = {};\r\n  data = [];\r\n  url = new URL('api/rest/categories?_sort=weight&_refs=subcategory', process.env.BACKEND_URL);\r\n\r\n  getTemplate() {\r\n    return `\r\n      <div class=\"categories\">\r\n        <div class=\"content__top-panel\">\r\n          <h1 class=\"page-title\">Product categories</h1>\r\n        </div>\r\n        <p>Subcategories can be dragged and dropped to change their order within their category.</p>\r\n        <div data-element=\"categoriesContainer\">\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  getCategories() {\r\n    for (const category of this.data) {\r\n      const categoryContainer = document.createElement('div');\r\n      categoryContainer.className = 'category'\r\n      categoryContainer.classList.add('category_open');\r\n      categoryContainer.dataset.id = `${category.id}`\r\n      categoryContainer.innerHTML = `<header class=\"category__header\">${category.title}</header>`;\r\n      categoryContainer.append(this.getCategoriesList(category));\r\n\r\n      this.subElements.categoriesContainer.append(categoryContainer);\r\n    }\r\n  }\r\n\r\n  getCategoriesList(category) {\r\n    const wrapper = document.createElement('div');\r\n\r\n    wrapper.innerHTML = `\r\n      <div class=\"category__body\">\r\n        <div class=\"subcategory-list\"></div>\r\n      <div>\r\n    `;\r\n\r\n    const categoriesBody = wrapper.firstElementChild;\r\n\r\n    const items = category.subcategories.map(({ id, title, count }) => this.getCategoriesItem(id, title, count));\r\n\r\n    const sortableList = new SortableList({items});\r\n\r\n    this.components = { sortableList };\r\n\r\n    const categoriesList = categoriesBody.querySelector('.subcategory-list');\r\n    categoriesList.append(sortableList.element);\r\n\r\n    return categoriesBody;\r\n  }\r\n\r\n  getCategoriesItem(id, title, count) {  \r\n    const wrapper = document.createElement('div');\r\n\r\n    wrapper.innerHTML = `\r\n      <li class=\"categories__sortable-list-item sortable-list__item\" data-grab-handle data-id=${id}>\r\n        <strong>${title}</strong>\r\n        <span><b>${count}</b> products</span>\r\n      </li>\r\n    `;\r\n\r\n    return wrapper.firstElementChild;\r\n  }\r\n\r\n  getSubElements() {\r\n    const elements = this.element.querySelectorAll(`[data-element]`);\r\n\r\n    return [...elements].reduce((acc, subElement) => {\r\n      acc[subElement.dataset.element] = subElement;\r\n\r\n      return acc;\r\n    }, {});\r\n  }\r\n\r\n  async render() {\r\n    this.data = await fetchJson(this.url);\r\n\r\n    const wrapper = document.createElement('div');\r\n\r\n    wrapper.innerHTML = this.getTemplate();\r\n\r\n    this.element = wrapper.firstElementChild;\r\n\r\n    this.subElements = this.getSubElements();\r\n\r\n    this.getCategories();\r\n    this.initEventListeners();\r\n    \r\n    return this.element;\r\n  }\r\n\r\n  onCategoryToggle = (event) => {\r\n    if (event.target.closest('.category__header')) {\r\n      const element = event.target.closest('.category__header').parentNode;\r\n      element.classList.toggle('category_open');\r\n    }\r\n  }\r\n\r\n  onOrderChange = (event) => {\r\n    const subcategories = [...event.target.children];\r\n\r\n    const data = subcategories.map((value, index) => {\r\n      return {\r\n          id: value.dataset.id,\r\n          weight: index + 1\r\n      };\r\n    });\r\n    \r\n    this.save(data);\r\n  }\r\n\r\n  async save(data) {\r\n    try {\r\n      await fetchJson(new URL('api/rest/subcategories', process.env.BACKEND_URL), {\r\n          method: 'PATCH',\r\n          body: JSON.stringify(data),\r\n          headers: {\r\n              'Content-type': 'application/json'\r\n          }\r\n      });\r\n      this.showNotification({\r\n        type: 'success',\r\n        text: 'Order was saved'\r\n      })\r\n\r\n    } catch (error) {\r\n      this.showNotification({\r\n        type: 'error',\r\n        text: `Error: ${error}`\r\n      })\r\n    }\r\n  }\r\n\r\n  showNotification(message) {\r\n    const notification = new NotificationMessage(message.text, {\r\n      duration: 2000,\r\n      type: message.type\r\n    });\r\n\r\n    this.components = { notification };\r\n\r\n    notification.show();\r\n  }\r\n\r\n  initEventListeners() {\r\n    this.element.addEventListener('pointerdown', this.onCategoryToggle);\r\n\r\n    this.subElements.categoriesContainer.addEventListener('sortable-list-reorder', this.onOrderChange);\r\n  }\r\n\r\n  remove() {\r\n    if (this.element) {\r\n      this.element.remove();\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n    this.element = null;\r\n    this.subElements = {};\r\n    this.components = {};\r\n    Object.values(this.components).forEach((component) => {\r\n      component.destroy();\r\n    });\r\n  }\r\n\r\n}","// same as fetch, but throws FetchError in case of errors\r\n// status >= 400 is an error\r\n// network error / json error are errors\r\n\r\nexport default async function(url, params) {\r\n  let response;\r\n\r\n  try {\r\n    // NOTE: \"toString\" call needed for correct work of \"jest-fetch-mock\"\r\n    response = await fetch(url.toString(), params);\r\n  } catch(err) {\r\n    throw new FetchError(response, \"Network error has occurred.\");\r\n  }\r\n\r\n  let body;\r\n\r\n  if (!response.ok) {\r\n    let errorText = response.statusText; // Not Found (for 404)\r\n\r\n    try {\r\n      body = await response.json();\r\n\r\n      errorText = (body.error && body.error.message) || (body.data && body.data.error && body.data.error.message) || errorText;\r\n    } catch (error) { /* ignore failed body */ }\r\n\r\n    let message = `Error ${response.status}: ${errorText}`;\r\n\r\n    throw new FetchError(response, body, message);\r\n  }\r\n\r\n  try {\r\n    return await response.json();\r\n  } catch(err) {\r\n    throw new FetchError(response, null, err.message);\r\n  }\r\n}\r\n\r\nexport class FetchError extends Error {\r\n  name = \"FetchError\";\r\n\r\n  constructor(response, body, message) {\r\n    super(message);\r\n    this.response = response;\r\n    this.body = body;\r\n  }\r\n}\r\n\r\n// handle uncaught failed fetch through\r\nwindow.addEventListener('unhandledrejection', event => {\r\n  if (event.reason instanceof FetchError) {\r\n    alert(event.reason.message);\r\n  }\r\n});\r\n\r\n"],"sourceRoot":""}