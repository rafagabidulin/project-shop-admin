{"version":3,"sources":["webpack://project-structure/./src/components/notification/index.js","webpack://project-structure/./src/components/sortable-list/index.js","webpack://project-structure/./src/utils/escape-html.js","webpack://project-structure/./src/components/product-form/icon-grab.svg","webpack://project-structure/./src/components/product-form/icon-trash.svg","webpack://project-structure/./src/components/product-form/index.js","webpack://project-structure/./src/pages/products/edit/index.js","webpack://project-structure/./src/utils/fetch-json.js"],"names":["NotificationMessage","constructor","message","duration","type","this","render","getTemplate","wrapper","document","createElement","innerHTML","element","firstElementChild","show","parent","body","activeMessage","remove","append","timerId","setTimeout","destroy","clearTimeout","SortableList","items","event","target","closest","preventDefault","onDragStart","moveAt","clientX","clientY","prevElement","placeholder","previousElementSibling","nextElement","nextElementSibling","lastElementChild","top","firstElementTop","getBoundingClientRect","bottom","before","after","height","middlePrevElement","middleNextElement","placeholderIndex","children","indexOf","replaceWith","dragElement","classList","style","cssText","removeEventListener","onPointerMove","onPointerUp","elementIndex","dispatchEvent","from","to","getItems","map","item","add","initEventListeners","left","width","offsetWidth","offsetHeight","getPlaceholder","addEventListener","className","details","CustomEvent","bubbles","onPointerDown","string","replace","ProductForm","productId","title","description","quantity","subcategory","status","images","price","discount","save","imageListContainer","uploadImage","subElements","fileInput","accept","async","file","files","formData","FormData","ploadImage","disabled","result","fetchJson","method","headers","Authorization","referrer","getImageItem","data","link","name","hidden","click","getSubElements","querySelectorAll","reduce","acc","subElement","dataset","getCategoriesSelect","categorySelect","categories","category","subcategories","Option","id","outerHTML","defaultFormData","categoriesPromise","productPromise","Promise","resolve","response","all","productData","setFormData","createImagesList","getFormData","excludedFields","formatToNumber","fields","Object","keys","filter","includes","getValue","field","productForm","querySelector","value","values","imagesHTMLCollection","image","push","url","src","source","alt","forEach","sortableList","iconGrab","escapeHtml","iconTrash","product","JSON","stringify","detail","onSubmit","Page","match","initComponents","components","getComponents","showNotification","text","component","params","fetch","toString","err","FetchError","ok","errorText","statusText","json","error","Error","super","window","reason","alert"],"mappings":"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","file":"products-edit-index-js-460.js","sourcesContent":["export default class NotificationMessage {\r\n  static activeMessage;\r\n  timerId;\r\n\r\n  constructor(message = '', {duration = 2000, type = 'success'} = {}) {\r\n    this.message = message;\r\n    this.duration = duration;\r\n    this.type = type;\r\n  \r\n    this.render();\r\n  }\r\n    \r\n  getTemplate() {\r\n    return `\r\n      <div class=\"notification ${this.type}\" style=\"--value:${this.duration / 1000}s\">\r\n        <div class=\"timer\"></div>\r\n        <div class=\"inner-wrapper\">\r\n          <div class=\"notification-header\">${this.type}</div>\r\n          <div class=\"notification-body\">\r\n            ${this.message}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n  \r\n  render() {\r\n    const wrapper = document.createElement('div');\r\n\r\n    wrapper.innerHTML = this.getTemplate();\r\n\r\n    this.element = wrapper.firstElementChild;\r\n  }\r\n  \r\n  show(parent = document.body) {\r\n    if (NotificationMessage.activeMessage) {\r\n      NotificationMessage.activeMessage.remove();\r\n    }\r\n    \r\n    parent.append(this.element);\r\n    \r\n    this.timerId = setTimeout(() => this.remove(), this.duration);\r\n\r\n    NotificationMessage.activeMessage = this.element;\r\n  }\r\n  \r\n  remove() {\r\n    this.element.remove();\r\n  }\r\n      \r\n  destroy() {\r\n    clearTimeout(this.timerId);\r\n    NotificationMessage.activeMessage = null;\r\n    this.remove();\r\n  }\r\n}\r\n","export default class SortableList {\r\n  element;\r\n  dragElement;\r\n  placeholder;\r\n  left;\r\n  top;\r\n\r\n  constructor({ items = [] } = {}) {\r\n    this.items = items;\r\n\r\n    this.render();\r\n  }\r\n\r\n  getTemplate() {\r\n    return `\r\n      <ul class='sortable-list'>\r\n      </ul>\r\n    `;\r\n  }\r\n\r\n  getItems() {\r\n    this.items.map((item) => {\r\n      item.classList.add('sortable-list__item');\r\n\r\n      this.element.append(item);\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const element = document.createElement('div');\r\n\r\n    element.innerHTML = this.getTemplate();\r\n\r\n    this.element = element.firstElementChild;\r\n\r\n    this.getItems();\r\n    this.initEventListeners();\r\n  }\r\n\r\n  onPointerDown = (event) => { \r\n    const element = event.target.closest('.sortable-list__item');\r\n\r\n    if (element) {\r\n      if (event.target.closest('[data-grab-handle]')) {\r\n        event.preventDefault();\r\n        this.onDragStart(event, element);\r\n      }\r\n      if (event.target.closest('[data-delete-handle]')) {\r\n        event.preventDefault();\r\n        element.remove();\r\n      }\r\n    }\r\n  }\r\n\r\n  onDragStart(event, element) {\r\n    this.left = event.clientX - element.getBoundingClientRect().left;\r\n    this.top = event.clientY - element.getBoundingClientRect().top;\r\n\r\n    this.dragElement = element;\r\n    this.elementIndex = [...this.element.children].indexOf(element);\r\n    this.dragElement.style.width = element.offsetWidth + 'px';\r\n    this.dragElement.style.height = element.offsetHeight + 'px';\r\n    this.dragElement.classList.add('sortable-list__item_dragging');\r\n\r\n    this.moveAt(event.clientX, event.clientY);\r\n    this.getPlaceholder(element);\r\n\r\n    document.addEventListener('pointermove', this.onPointerMove);\r\n    document.addEventListener('pointerup', this.onPointerUp);\r\n  }\r\n\r\n  getPlaceholder(element) {\r\n    this.placeholder = document.createElement('div');\r\n    this.placeholder.className = 'sortable-list__placeholder';\r\n    this.placeholder.style.width = element.style.width;\r\n    this.placeholder.style.height = element.style.height;\r\n    \r\n    element.after(this.placeholder);   \r\n  }\r\n\r\n  moveAt(clientX, clientY) {\r\n    this.dragElement.style.left = `${clientX - this.left}px`;\r\n    this.dragElement.style.top = `${clientY - this.top}px`;\r\n  }\r\n\r\n  onPointerMove = (event) => {\r\n    this.moveAt(event.clientX, event.clientY);\r\n\r\n    const prevElement = this.placeholder.previousElementSibling;\r\n    const nextElement = this.placeholder.nextElementSibling;\r\n\r\n    const { firstElementChild, lastElementChild } = this.element;\r\n    const { top: firstElementTop } = firstElementChild.getBoundingClientRect();\r\n    const { bottom } = this.element.getBoundingClientRect;\r\n\r\n    if (event.clientY < firstElementTop) {\r\n      return firstElementChild.before(this.placeholder);\r\n    }\r\n\r\n    if (event.clientY > bottom) {\r\n      return lastElementChild.after(this.placeholder);\r\n    }\r\n\r\n    if (prevElement) {\r\n      const { top, height } = prevElement.getBoundingClientRect();\r\n      const middlePrevElement = top + height / 2;\r\n\r\n      if (event.clientY < middlePrevElement) {\r\n        return prevElement.before(this.placeholder);\r\n      }\r\n    }\r\n\r\n    if (nextElement) {\r\n      const { top, height } = nextElement.getBoundingClientRect();\r\n      const middleNextElement = top + height / 2;\r\n\r\n      if (event.clientY > middleNextElement) {\r\n        return nextElement.after(this.placeholder);\r\n      }\r\n    }\r\n  }\r\n\r\n  onPointerUp = () => {\r\n    const placeholderIndex = [...this.element.children].indexOf(this.placeholder);\r\n\r\n    this.placeholder.replaceWith(this.dragElement);\r\n    \r\n    this.dragElement.classList.remove('sortable-list__item_dragging');\r\n    this.dragElement.style.cssText = '';\r\n\r\n    document.removeEventListener('pointermove', this.onPointerMove);\r\n    document.removeEventListener('pointerup', this.onPointerUp);\r\n\r\n    if (placeholderIndex !== this.elementIndex) {\r\n      this.dispatchEvent('sortable-list-reorder', {\r\n        from: this.elementIndex,\r\n        to: placeholderIndex\r\n      });\r\n    }\r\n  }\r\n\r\n  dispatchEvent(type, details) {\r\n    this.element.dispatchEvent(\r\n      new CustomEvent(type, {\r\n        bubbles: true,\r\n        details\r\n      })\r\n    );\r\n  }\r\n\r\n  initEventListeners() {\r\n    this.element.addEventListener('pointerdown', this.onPointerDown);\r\n  }\r\n\r\n  remove() {\r\n    if (this.element) {\r\n      this.element.remove();  \r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n    this.element = null;\r\n    this.dragElement = null;\r\n    this.placeholder = null;\r\n  }\r\n}\r\n","export default string => string\r\n  .replace(/&/g, '&amp;')\r\n  .replace(/\"/g, '&quot;')\r\n  .replace(/'/g, '&#39;')\r\n  .replace(/</g, '&lt;')\r\n  .replace(/>/g, '&gt;');\r\n","export default __webpack_public_path__ + \"src/components/product-form/icon-grab.svg\";","export default __webpack_public_path__ + \"src/components/product-form/icon-trash.svg\";","import SortableList from '../sortable-list/index.js';\r\nimport escapeHtml from '../../utils/escape-html.js';\r\nimport fetchJson from '../../utils/fetch-json.js';\r\n\r\nimport iconGrab from './icon-grab.svg';\r\nimport iconTrash from './icon-trash.svg';\r\n\r\nexport default class ProductForm {\r\n  element;\r\n  subElements = {};\r\n\r\n  defaultFormData = {\r\n    title: '',\r\n    description: '',\r\n    quantity: 1,\r\n    subcategory: '',\r\n    status: 1,\r\n    images: [],\r\n    price: 100,\r\n    discount: 0\r\n  };\r\n\r\n  constructor(productId) {\r\n    this.productId = productId;\r\n  }\r\n\r\n  getSubElements(element) {\r\n    const elements = element.querySelectorAll(`[data-element]`);\r\n\r\n    return [...elements].reduce((acc, subElement) => {\r\n      acc[subElement.dataset.element] = subElement;\r\n\r\n      return acc;\r\n    }, {});\r\n  }\r\n\r\n  getCategoriesSelect() {\r\n    const wrapper = document.createElement('div');\r\n\r\n    wrapper.innerHTML = `<select class=\"form-control\" name=\"subcategory\" id=\"subcategory\"></select>`;\r\n\r\n    const categorySelect = wrapper.firstElementChild;\r\n\r\n    this.categories.map((category) => {\r\n      return category.subcategories.map((subcategory) => {\r\n        categorySelect.append(new Option(`${category.title} > ${subcategory.title}`, subcategory.id));\r\n      });\r\n    });\r\n\r\n    return categorySelect.outerHTML;\r\n  }\r\n\r\n  getTemplate() {\r\n    return `\r\n      <div class=\"product-form\">\r\n      <form data-element=\"productForm\" class=\"form-grid\">\r\n        <div class=\"form-group form-group__half_left\">\r\n          <fieldset>\r\n            <label class=\"form-label\">Название товара</label>\r\n            <input required\r\n              id=\"title\"\r\n              value=\"\"\r\n              type=\"text\"\r\n              name=\"title\"\r\n              class=\"form-control\"\r\n              placeholder=\"Название товара\">\r\n          </fieldset>\r\n        </div>\r\n        <div class=\"form-group form-group__wide\">\r\n          <label class=\"form-label\">Описание</label>\r\n          <textarea required\r\n            id=\"description\"\r\n            class=\"form-control\"\r\n            name=\"description\"\r\n            data-element=\"productDescription\"\r\n            placeholder=\"Описание товара\"></textarea>\r\n        </div>\r\n        <div class=\"form-group form-group__wide\">\r\n          <label class=\"form-label\">Фото</label>\r\n          <div data-element=\"imageListContainer\">\r\n          </div>\r\n          <button data-element=\"uploadImage\" type=\"button\" class=\"button-primary-outline\">\r\n            <span>Загрузить</span>\r\n          </button>\r\n        </div>\r\n        <div class=\"form-group form-group__half_left\">\r\n          <label class=\"form-label\">Категория</label>\r\n            ${this.getCategoriesSelect()}\r\n        </div>\r\n        <div class=\"form-group form-group__half_left form-group__two-col\">\r\n          <fieldset>\r\n            <label class=\"form-label\">Цена ($)</label>\r\n            <input required\r\n              id=\"price\"\r\n              value=\"\"\r\n              type=\"number\"\r\n              name=\"price\"\r\n              class=\"form-control\"\r\n              placeholder=\"${this.defaultFormData.price}\">\r\n          </fieldset>\r\n          <fieldset>\r\n            <label class=\"form-label\">Скидка ($)</label>\r\n            <input required\r\n              id=\"discount\"\r\n              value=\"\"\r\n              type=\"number\"\r\n              name=\"discount\"\r\n              class=\"form-control\"\r\n              placeholder=\"${this.defaultFormData.discount}\">\r\n          </fieldset>\r\n        </div>\r\n        <div class=\"form-group form-group__part-half\">\r\n          <label class=\"form-label\">Количество</label>\r\n          <input required\r\n            id=\"quantity\"\r\n            value=\"\"\r\n            type=\"number\"\r\n            class=\"form-control\"\r\n            name=\"quantity\"\r\n            placeholder=\"${this.defaultFormData.quantity}\">\r\n        </div>\r\n        <div class=\"form-group form-group__part-half\">\r\n          <label class=\"form-label\">Статус</label>\r\n          <select id=\"status\" class=\"form-control\" name=\"status\">\r\n            <option value=\"1\">Активен</option>\r\n            <option value=\"0\">Неактивен</option>\r\n          </select>\r\n        </div>\r\n        <div class=\"form-buttons\">\r\n          <button type=\"submit\" name=\"save\" class=\"button-primary-outline\">\r\n            ${this.productId ? 'Сохранить' : 'Добавить'} товар\r\n          </button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n    `;\r\n  }\r\n\r\n  async render() {\r\n    const categoriesPromise = fetchJson(\r\n      `${process.env.BACKEND_URL}api/rest/categories?_sort=weight&_refs=subcategory`\r\n    );\r\n\r\n    const productPromise = this.productId\r\n      ? fetchJson(`${process.env.BACKEND_URL}api/rest/products?id=${this.productId}`)\r\n      : Promise.resolve([this.defaultFormData]);\r\n\r\n    const [data, response] = await Promise.all([categoriesPromise, productPromise]);\r\n\r\n    const [productData] = response;\r\n\r\n    this.formData = productData;\r\n    this.categories = data;\r\n\r\n    const wrapper = document.createElement('div');\r\n   \r\n    wrapper.innerHTML = this.getTemplate();\r\n\r\n    this.element = wrapper.firstElementChild;\r\n\r\n    this.subElements = this.getSubElements(this.element);\r\n\r\n    if (this.formData) {\r\n      this.setFormData();\r\n      this.createImagesList();\r\n      this.initEventListeners();\r\n    }\r\n\r\n    return this.element;\r\n  }\r\n\r\n  getFormData() {\r\n    const excludedFields = ['images'];\r\n    const formatToNumber = ['price', 'quantity', 'discount', 'status'];\r\n    const fields = Object.keys(this.defaultFormData).filter(item => !excludedFields.includes(item));\r\n    const getValue = field => this.subElements.productForm.querySelector(`[name=${field}]`).value;\r\n    const values = {};\r\n\r\n    for (const field of fields) {\r\n      const value = getValue(field);\r\n\r\n      values[field] = formatToNumber.includes(field) ? +value : value;\r\n    }\r\n\r\n    const imagesHTMLCollection = this.subElements.imageListContainer.querySelectorAll('.sortable-table__cell-img');\r\n\r\n    values.images = [];\r\n    values.id = this.productId;\r\n\r\n    for (const image of imagesHTMLCollection) {\r\n      values.images.push({\r\n        url: image.src,\r\n        source: image.alt\r\n      });\r\n    }\r\n\r\n    return values;\r\n  }\r\n\r\n  setFormData() {\r\n    const excludedFields = ['images'];\r\n\r\n    const fields = Object.keys(this.defaultFormData).filter(item => !excludedFields.includes(item));\r\n    fields.forEach(item => {\r\n      const element = this.subElements.productForm.querySelector(`#${item}`);\r\n\r\n      element.value = this.formData[item] || this.defaultFormData[item];\r\n    });\r\n  }\r\n\r\n  createImagesList() {\r\n    const { imageListContainer } = this.subElements;\r\n\r\n    const items = this.formData.images.map(({ url, source }) => this.getImageItem(url, source));\r\n\r\n    const sortableList = new SortableList({items});\r\n\r\n    imageListContainer.append(sortableList.element);\r\n  }\r\n\r\n  getImageItem(url, source) {\r\n    const wrapper = document.createElement('div');\r\n\r\n    wrapper.innerHTML = `\r\n      <li class=\"products-edit__imagelist-item sortable-list__item\">\r\n        <span>\r\n          <img src=${iconGrab} data-grab-handle alt=\"grab\">\r\n          <img class=\"sortable-table__cell-img\" alt=\"${escapeHtml(source)}\" src=\"${escapeHtml(url)}\">\r\n          <span>${escapeHtml(source)}</span>\r\n        </span>\r\n        <button type=\"button\">\r\n          <img src=${iconTrash} alt=\"delete\" data-delete-handle>\r\n        </button>\r\n      </li>`;\r\n\r\n    return wrapper.firstElementChild;\r\n  }\r\n\r\n  onSubmit = (event) => {\r\n    event.preventDefault();\r\n\r\n    this.save();\r\n  };\r\n\r\n  async save() {\r\n    const product = this.getFormData();\r\n\r\n    const result = await fetchJson(`${process.env.BACKEND_URL}api/rest/products`, {\r\n      method: this.productId ? 'PATCH' : 'PUT',\r\n      headers: {\r\n        'Content-Type': 'application/json'\r\n      },\r\n      body: JSON.stringify(product)\r\n    });\r\n\r\n    this.dispatchEvent(result.id, 'success');\r\n  }\r\n\r\n  dispatchEvent(id, status) {\r\n    const event = this.productId\r\n      ? new CustomEvent('product-updated', { detail: { id, status } })\r\n      : new CustomEvent('product-saved', { detail: { status } });\r\n\r\n    this.element.dispatchEvent(event);\r\n  }\r\n\r\n  uploadImage = () => {\r\n    const { imageListContainer, uploadImage } = this.subElements;\r\n    const fileInput = document.createElement('input');\r\n\r\n    fileInput.type = 'file';\r\n    fileInput.accept = 'image/*';\r\n\r\n    fileInput.addEventListener('change', async () => {\r\n      const [file] = fileInput.files;\r\n\r\n      if (file) {\r\n        const formData = new FormData();\r\n\r\n        formData.append('image', file);\r\n\r\n        uploadImage.classList.add('is-loading');\r\n        ploadImage.disabled = true;\r\n\r\n        const result = await fetchJson('https://api.imgur.com/3/image', {\r\n          method: 'POST',\r\n          headers: {\r\n            Authorization: `Client-ID ${process.env.IMGUR_CLIENT_ID}`\r\n          },\r\n          body: formData,\r\n          referrer: ''\r\n        });\r\n\r\n        imageListContainer.firstElementChild.append(this.getImageItem(result.data.link, file.name));\r\n\r\n        uploadImage.classList.remove('is-loading');\r\n        uploadImage.disabled = false;\r\n\r\n        fileInput.remove();\r\n      }\r\n    });\r\n\r\n    fileInput.hidden = true;\r\n    document.body.append(fileInput);\r\n\r\n    fileInput.click();\r\n  };\r\n\r\n  initEventListeners() {\r\n    const { productForm, uploadImage } = this.subElements;\r\n\r\n    productForm.addEventListener('submit', this.onSubmit);\r\n    \r\n    uploadImage.addEventListener('click', this.uploadImage);\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n    this.element = null;\r\n    this.subElements = null;\r\n  }\r\n}\r\n","import ProductForm from '../../../components/product-form';\r\nimport NotificationMessage from '../../../components/notification';\r\n\r\nexport default class Page {\r\n  element;\r\n  components = {};\r\n  subElements = {};\r\n\r\n  constructor(match) {\r\n    this.productId = match[1];\r\n  }\r\n\r\n  getTemplate() {\r\n    return `\r\n      <div class=\"products-edit\">\r\n        <div class=\"content__top-panel\">\r\n          <h1 class=\"page-title\">\r\n            <a href=\"/products\" class=\"link\">Products</a> / ${this.productId ? 'Edit' : 'Add'}\r\n          </h1>\r\n        </div>\r\n        <div class=\"content-box\">\r\n          <div class=\"product-form\" data-element=\"productForm\">\r\n            </div>\r\n        </div>\r\n      </div>`;\r\n  }\r\n\r\n  getSubElements() {\r\n    const elements = this.element.querySelectorAll(`[data-element]`);\r\n\r\n    return [...elements].reduce((acc, subElement) => {\r\n      acc[subElement.dataset.element] = subElement;\r\n\r\n      return acc;\r\n    }, {});\r\n  }\r\n\r\n  initComponents() {\r\n    const productForm = new ProductForm(this.productId);\r\n\r\n    this.components = {\r\n      productForm,\r\n    }\r\n  }\r\n\r\n  async getComponents() {\r\n    const productForm = await this.components.productForm.render();\r\n\r\n    this.subElements.productForm.append(productForm);\r\n  }\r\n\r\n  async render() {\r\n    const wrapper = document.createElement('div');\r\n\r\n    wrapper.innerHTML = this.getTemplate();\r\n\r\n    this.element = wrapper.firstElementChild;\r\n\r\n    this.subElements = this.getSubElements();\r\n\r\n    this.initComponents();\r\n    await this.getComponents();\r\n    this.initEventListeners();\r\n    \r\n    return this.element;\r\n  }\r\n\r\n  initEventListeners() {\r\n    const  { productForm } = this.components;\r\n\r\n    productForm.element.addEventListener('product-updated', (event) => {\r\n      this.showNotification({\r\n        type: event.detail.status,\r\n        text: event.detail.status === 'success' ? 'Product was updated' : 'Product update error',\r\n      });\r\n    });\r\n\r\n    productForm.element.addEventListener('product-saved', (event) => {\r\n      this.showNotification({\r\n        type: event.detail.status,\r\n        text: event.detail.status === 'success' ? 'Product was saved' : 'Product save error'\r\n      });\r\n    });\r\n  }\r\n\r\n  showNotification(message) {\r\n    const notification = new NotificationMessage(message.text, {\r\n      duration: 2000,\r\n      type: message.type\r\n    });\r\n\r\n    notification.show(this.components.productForm.element);\r\n  }\r\n\r\n  remove() {\r\n    if (this.element) {\r\n      this.element.remove();\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n    this.element = null;\r\n    this.components = {};\r\n    Object.values(this.components).forEach((component) => {\r\n      component.destroy();\r\n    });\r\n  }\r\n\r\n}\r\n","// same as fetch, but throws FetchError in case of errors\r\n// status >= 400 is an error\r\n// network error / json error are errors\r\n\r\nexport default async function(url, params) {\r\n  let response;\r\n\r\n  try {\r\n    // NOTE: \"toString\" call needed for correct work of \"jest-fetch-mock\"\r\n    response = await fetch(url.toString(), params);\r\n  } catch(err) {\r\n    throw new FetchError(response, \"Network error has occurred.\");\r\n  }\r\n\r\n  let body;\r\n\r\n  if (!response.ok) {\r\n    let errorText = response.statusText; // Not Found (for 404)\r\n\r\n    try {\r\n      body = await response.json();\r\n\r\n      errorText = (body.error && body.error.message) || (body.data && body.data.error && body.data.error.message) || errorText;\r\n    } catch (error) { /* ignore failed body */ }\r\n\r\n    let message = `Error ${response.status}: ${errorText}`;\r\n\r\n    throw new FetchError(response, body, message);\r\n  }\r\n\r\n  try {\r\n    return await response.json();\r\n  } catch(err) {\r\n    throw new FetchError(response, null, err.message);\r\n  }\r\n}\r\n\r\nexport class FetchError extends Error {\r\n  name = \"FetchError\";\r\n\r\n  constructor(response, body, message) {\r\n    super(message);\r\n    this.response = response;\r\n    this.body = body;\r\n  }\r\n}\r\n\r\n// handle uncaught failed fetch through\r\nwindow.addEventListener('unhandledrejection', event => {\r\n  if (event.reason instanceof FetchError) {\r\n    alert(event.reason.message);\r\n  }\r\n});\r\n\r\n"],"sourceRoot":""}